<app-admin-layout></app-admin-layout>
<div class="container mt-4">
<div class="container mt-4">
  
  <!-- ✅ Alert Message -->
  <div *ngIf="alertMessage" class="alert alert-{{alertType}} alert-dismissible fade show" role="alert">
    {{ alertMessage }}
    <button type="button" class="btn-close" aria-label="Close" (click)="alertMessage = null"></button>
  </div>

  <!-- Rest of your Header Card, Filter Card, Table ... -->
  <!-- Header Card -->
  <div class="card p-3 mb-4 shadow-sm">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <h3 class="fw-bold text-dark m-0">User Management</h3>
      <button class="btn btn-primary add-btn" 
              (click)="openAddUser()" 
              data-bs-toggle="modal" 
              data-bs-target="#userModal">
        ➕ Add User
      </button>
    </div>
  </div>

  <!-- Filter Card -->
  <div class="card p-3 mb-4 shadow-sm">
    <div class="row g-3">
      <div class="col-md-4">
        <input id="searchUser" type="text" class="form-control" placeholder="🔍 Search by Username"
               [(ngModel)]="searchTerm" name="searchUser"/>
      </div>
      <div class="col-md-4">
        <select id="statusFilter" class="form-select" [(ngModel)]="selectedStatus" name="statusFilter">
          <option value="all">All Status</option>
          <option value="active">Active</option>
          <option value="inactive">Blocked</option>
        </select>
      </div>
      <div class="col-md-4">
        <select id="roleFilter" class="form-select" [(ngModel)]="selectedRole" name="roleFilter">
          <option value="all">All Roles</option>
          <option value="admin">Admin</option>
          <option value="cashier">Cashier</option>
          
        </select>
      </div>
    </div>
  </div>
   
  <!-- User List Card -->
  <div class="card p-3 shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light text-center">
          <tr>
            <th>User</th>
            <th>Role</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody class="text-center">
          <tr *ngFor="let user of filteredUsers">
            <td>
              <div class="fw-bold">{{ user.username }}</div>
              <small class="text-muted">{{ user.email }}</small>
            </td>
            <td>
              <span class="badge bg-info text-dark px-3">{{ user.role }}</span>
            </td>
            <td>
              <span class="badge" [ngClass]="user.is_active ? 'bg-success' : 'bg-danger'">
                {{ user.is_active ? 'Active' : 'Blocked' }}
              </span>
            </td>
            <td>
              <button class="btn btn-outline-secondary me-2" 
                      (click)="openEditUser(user)" 
                      data-bs-toggle="modal" 
                      data-bs-target="#userModal">
                <i class="bi bi-pencil-square"></i> Edit
              </button>
  
              <button *ngIf="user.is_active" class="btn btn-outline-warning me-2" 
                      (click)="blockUser(user.id)">
                <i class="bi bi-slash-circle"></i> 🚫 Block
              </button>
  
              <button *ngIf="!user.is_active" class="btn btn-outline-success me-2" 
                      (click)="unblockUser(user.id)">
                <i class="bi bi-check-circle"></i> ✅ Unblock
              </button>
  
              <button class="btn btn-outline-danger" (click)="deleteUser(user.id)">
                <i class="bi bi-trash"></i> 🗑 Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- 🚀 Unified Add/Edit User Modal -->
<div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEditMode ? 'Edit User' : 'Add User' }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form #userForm="ngForm" (ngSubmit)="isEditMode ? updateUser() : registerUser()">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input [(ngModel)]="currentUser.username" name="username" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input [(ngModel)]="currentUser.email" name="email" type="email" class="form-control" required />
          </div>

          <!-- ✅ Password always shown: required in Add mode, optional in Edit -->
          <div class="mb-3">
            <label class="form-label">
              Password 
              <small *ngIf="isEditMode" class="text-muted">(leave blank to keep unchanged)</small>
            </label>
            <input [(ngModel)]="currentUser.password"
                   name="password"
                   type="password"
                   class="form-control"
                   [required]="!isEditMode" />
          </div>

          <div class="mb-3">
            <label class="form-label">Role</label>
            <select [(ngModel)]="currentUser.role" name="role" class="form-select">
              <option value="admin">Admin</option>
              <option value="cashier">Cashier</option>
            
            </select>
          </div>

          <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">
              {{ isEditMode ? 'Update User' : 'Save User' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>